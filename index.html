<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Maze Game</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      margin:0; font-family:sans-serif;
      background: #222;
      color:#fff;
    }
    #menu, #about, #controls, #ballSelect, #game, #scoreScreen { 
      display: none; 
      flex-direction: column; 
      align-items: center; 
      justify-content: center; 
      min-height: 100vh;
      width: 100vw;
      position: absolute;
      left: 0; top: 0;
      z-index: 10;
      background: transparent;
    }
    .menu-btn { background: #444; color: #fff; border: none; margin: 15px; padding: 20px 50px; font-size: 1.3em; border-radius: 12px; cursor:pointer; transition: background .2s;}
    .menu-btn:hover { background: #666; }
    #ballOptions { display: flex; gap: 20px; margin-top: 30px; }
    .ball-option { width:60px; height:60px; border-radius:50%; border: 4px solid #fff; cursor:pointer; display:flex;align-items:center;justify-content:center; font-weight:bold; font-size:1.1em;}
    .ball-red { background:#e74c3c; }
    .ball-blue { background:#3498db; }
    .ball-green { background:#27ae60; }
    .ball-black { background:#222; border-color:#e74c3c; }
    #mazeCanvas { background: rgba(255,255,255,0.96); border: 5px solid #444; display: block; margin: 20px auto; touch-action: none;}
    #controlsUI { display: flex; justify-content: center; margin-top: 15px; gap: 15px; }
    .ctrl-btn { background: #555; color: #fff; border: none; border-radius: 12px; font-size: 1.4em; padding: 25px 32px; cursor:pointer; transition: background .2s; min-width: 80px; min-height: 60px;}
    .ctrl-btn:active { background: #888; }
    #timer { font-size: 1.4em; margin-top: 10px; color: #e74c3c; }
    #scoreScreen h2 { color: #27ae60; }
    @media (max-width:600px) {
      .menu-btn, .ctrl-btn { font-size:1em; padding:15px 20px; }
      #mazeCanvas { width:97vw; }
      .ball-option { width:40px; height:40px; font-size:1em; }
    }
  </style>
</head>
<body>
  <!-- Menu Screen -->
  <div id="menu" style="display:flex;">
    <h1 style="text-shadow: 2px 3px 16px #0b6dcc;">Maze Game</h1>
    <button class="menu-btn" onclick="showBallSelect()">1. Start Game</button>
    <button class="menu-btn" onclick="showControls()">2. Controls</button>
    <button class="menu-btn" onclick="showAbout()">3. About Developer</button>
  </div>
  <!-- Controls Screen -->
  <div id="controls">
    <h2>Controls</h2>
    <p>
      Use the four buttons or keyboard:<br>
      <strong>↑</strong> Up or <strong>W</strong> &nbsp; <strong>↓</strong> Down or <strong>S</strong> &nbsp;
      <strong>←</strong> Left or <strong>A</strong> &nbsp; <strong>→</strong> Right or <strong>D</strong><br>
      Tap or use keys to move your ball. Reach the exit before time runs out!
    </p>
    <button class="menu-btn" onclick="showMenu()">Back</button>
  </div>
  <!-- About Developer -->
  <div id="about">
    <h2>About Developer</h2>
    <p style="max-width: 600px;">
      Saad is an 18-year-old amateur game developer from Islamabad who is just starting his journey in the world of game development. Though still learning, he has a genuine passion for creating games and spends much of his free time experimenting with simple projects and exploring new tools. Saad enjoys turning his creative ideas into small, playable experiences, even if they're not perfect yet. He's teaching himself the basics of coding and design, slowly building his skills one step at a time. As an enthusiastic beginner, Saad is eager to keep improving and dreams of one day creating a game that people around the world will enjoy.
    </p>
    <button class="menu-btn" onclick="showMenu()">Back</button>
  </div>
  <!-- Ball Select Screen -->
  <div id="ballSelect">
    <h2>Select Your Ball</h2>
    <div id="ballOptions">
      <div class="ball-option ball-red" onclick="startGame('red')" title="Red"></div>
      <div class="ball-option ball-blue" onclick="startGame('blue')" title="Blue"></div>
      <div class="ball-option ball-green" onclick="startGame('green')" title="Green"></div>
      <div class="ball-option ball-black" onclick="startGame('black')" title="Black"></div>
    </div>
    <button class="menu-btn" onclick="showMenu()" style="margin-top:25px;">Back</button>
  </div>
  <!-- Game Screen -->
  <div id="game">
    <div id="timer">Time: <span id="timeLeft">120</span>s</div>
    <canvas id="mazeCanvas" width="620" height="620"></canvas>
    <div id="controlsUI">
      <button class="ctrl-btn" onclick="moveBall('up')">↑</button>
      <button class="ctrl-btn" onclick="moveBall('left')">←</button>
      <button class="ctrl-btn" onclick="moveBall('down')">↓</button>
      <button class="ctrl-btn" onclick="moveBall('right')">→</button>
    </div>
  </div>
  <!-- Score Screen -->
  <div id="scoreScreen">
    <h2 id="scoreMsg"></h2>
    <p id="scoreDetails"></p>
    <button class="menu-btn" onclick="showMenu()">Back to Menu</button>
  </div>
<script>
  // UI State
  function hideAll() {
    document.querySelectorAll("#menu,#controls,#about,#ballSelect,#game,#scoreScreen")
      .forEach(e=>e.style.display='none');
  }
  function showMenu() { hideAll(); document.getElementById('menu').style.display='flex'; stopTimer(); }
  function showControls() { hideAll(); document.getElementById('controls').style.display='flex'; }
  function showAbout() { hideAll(); document.getElementById('about').style.display='flex'; }
  function showBallSelect() { hideAll(); document.getElementById('ballSelect').style.display='flex'; }
  function showGame() { hideAll(); document.getElementById('game').style.display='flex'; }
  function showScoreScreen(win, score) {
    hideAll();
    document.getElementById('scoreScreen').style.display='flex';
    document.getElementById('scoreMsg').textContent = win ? "You Won!" : "Game Over";
    let details = win 
      ? `You reached the exit! Time remaining: ${score}s`
      : `You failed to escape the maze in time.`;
    document.getElementById('scoreDetails').textContent = details;
  }

  // MAZE GENERATION (Recursive Backtracking, proper maze)
  const MAZE_SIZE = 31;
  let maze = [];
  let startRow=1, startCol=1, exitRow=MAZE_SIZE-2, exitCol=MAZE_SIZE-2;
  function generateMaze() {
    maze = [];
    for(let r=0;r<MAZE_SIZE;r++) {
      maze[r]=[];
      for(let c=0;c<MAZE_SIZE;c++) maze[r][c]=1;
    }
    function shuffle(arr) {
      for(let i=arr.length-1;i>0;i--){
        let j=Math.floor(Math.random()*(i+1));
        [arr[i],arr[j]]=[arr[j],arr[i]];
      }
      return arr;
    }
    function carve(r,c) {
      maze[r][c]=0;
      let dirs = shuffle([[0,-2],[0,2],[-2,0],[2,0]]);
      for(let [dr,dc] of dirs) {
        let nr = r+dr, nc = c+dc;
        if(nr>0 && nr<MAZE_SIZE-1 && nc>0 && nc<MAZE_SIZE-1 && maze[nr][nc]==1) {
          maze[r+dr/2][c+dc/2]=0;
          carve(nr,nc);
        }
      }
    }
    carve(startRow,startCol);
    maze[exitRow][exitCol]='E';
    // Add some random loops for complexity
    for(let i=0;i<12;i++) {
      let r = Math.floor(Math.random()*(MAZE_SIZE-3))+2;
      let c = Math.floor(Math.random()*(MAZE_SIZE-3))+2;
      if(maze[r][c]===1 &&
        ((maze[r-1][c]===0 && maze[r+1][c]===0) || (maze[r][c-1]===0 && maze[r][c+1]===0))
      ) {
        maze[r][c]=0;
      }
    }
    // Widen some corridors randomly (simulate variable widths)
    for(let i=0;i<8;i++) {
      let r = Math.floor(Math.random()*(MAZE_SIZE-3))+1;
      let c = Math.floor(Math.random()*(MAZE_SIZE-3))+1;
      if(maze[r][c]==0) {
        maze[r][c+1]=0;
        maze[r+1][c]=0;
      }
    }
  }
  // Ball and Game State
  let ball = {row:startRow, col:startCol, x:0, y:0, color:'red', radius:9, vx:0, vy:0};
  let ballMoving = false;
  let timer = 120, timerID=null, gameActive=false;
  function startGame(color) {
    ball.color = color;
    ball.row = startRow; ball.col = startCol;
    ball.x = ball.col * 20 + 10; ball.y = ball.row * 20 + 10;
    ball.vx = 0; ball.vy = 0;
    timer = 120;
    showGame();
    generateMaze();
    drawMaze();
    updateTimer();
    gameActive = true;
    startTimer();
  }
  function drawMaze() {
    const canvas = document.getElementById('mazeCanvas'), ctx = canvas.getContext('2d');
    ctx.clearRect(0,0,canvas.width,canvas.height);
    // Draw maze
    for(let r=0;r<MAZE_SIZE;r++) {
      for(let c=0;c<MAZE_SIZE;c++) {
        let cell = maze[r][c];
        let x = c*20, y = r*20;
        if(cell === 1) {
          ctx.fillStyle = "#222";
          ctx.fillRect(x, y, 20, 20);
        } else if(cell === 'E') {
          ctx.fillStyle = "#fff";
          ctx.fillRect(x, y, 20, 20);
          ctx.fillStyle = "#e74c3c";
          ctx.fillRect(x, y+14, 20, 6);
        } else {
          ctx.fillStyle = "#fff";
          ctx.fillRect(x, y, 20, 20);
        }
      }
    }
    // Draw ball
    ctx.save();
    ctx.beginPath();
    ctx.arc(ball.x, ball.y, ball.radius, 0, 2*Math.PI);
    ctx.fillStyle = 
      ball.color=='red'? '#e74c3c' :
      ball.color=='blue'? '#3498db' :
      ball.color=='green'? '#27ae60' : '#222';
    ctx.shadowColor = '#888';
    ctx.shadowBlur = 9;
    ctx.fill();
    ctx.restore();
  }
  // Ball mechanics: ultra smooth movement
  function moveBall(dir) {
    if(!gameActive) return;
    if(ballMoving) return;
    let dr=0,dc=0;
    if(dir=='up' || dir=='w') dr=-1;
    if(dir=='down' || dir=='s') dr=1;
    if(dir=='left' || dir=='a') dc=-1;
    if(dir=='right' || dir=='d') dc=1;
    let nr = ball.row+dr, nc = ball.col+dc;
    if(nr<0||nr>=MAZE_SIZE||nc<0||nc>=MAZE_SIZE) return;
    let nextCell = maze[nr][nc];
    if(nextCell === 1) return; // Wall
    ballMoving = true;
    let targetX = nc*20+10, targetY = nr*20+10;
    let duration = 180; // ms
    let startTime = null;
    let sx = ball.x, sy = ball.y;
    function animate(ts) {
      if(!startTime) startTime = ts;
      let elapsed = ts - startTime;
      let t = Math.min(elapsed/duration,1);
      ball.x = sx + (targetX - sx)*easeInOutQuad(t);
      ball.y = sy + (targetY - sy)*easeInOutQuad(t);
      drawMaze();
      if(t<1) requestAnimationFrame(animate);
      else {
        ball.x = targetX; ball.y = targetY;
        ball.row = nr; ball.col = nc;
        ballMoving = false;
        drawMaze();
        checkWinOrLose();
      }
    }
    requestAnimationFrame(animate);
  }
  function easeInOutQuad(t) {
    return t<0.5 ? 2*t*t : -1+(4-2*t)*t;
  }
  function checkWinOrLose() {
    if(maze[ball.row][ball.col] === 'E') {
      gameActive = false;
      stopTimer();
      showScoreScreen(true, timer);
    }
  }
  // Timer
  function startTimer() {
    timerID = setInterval(function(){
      if(!gameActive) return;
      timer--;
      updateTimer();
      if(timer<=0) {
        gameActive=false;
        stopTimer();
        showScoreScreen(false, 0);
      }
    },1000);
  }
  function stopTimer() {
    if(timerID) clearInterval(timerID);
    timerID=null;
  }
  function updateTimer() {
    document.getElementById('timeLeft').textContent = timer;
  }
  showMenu();
  // Touch gestures (mobile)
  let touchStartX=0, touchStartY=0;
  document.getElementById('mazeCanvas').addEventListener('touchstart',function(e){
    if(e.touches.length==1) {
      touchStartX = e.touches[0].clientX;
      touchStartY = e.touches[0].clientY;
    }
  });
  document.getElementById('mazeCanvas').addEventListener('touchend',function(e){
    if(e.changedTouches.length==1) {
      let dx = e.changedTouches[0].clientX - touchStartX;
      let dy = e.changedTouches[0].clientY - touchStartY;
      if(Math.abs(dx)>Math.abs(dy)) {
        if(dx>30) moveBall('right');
        else if(dx<-30) moveBall('left');
      } else {
        if(dy>30) moveBall('down');
        else if(dy<-30) moveBall('up');
      }
    }
  });
  // Keyboard controls (WASD and Arrow keys)
  document.addEventListener('keydown', function(e){
    if(!gameActive) return;
    if(ballMoving) return;
    if(e.key === "ArrowUp" || e.key === "w" || e.key === "W") moveBall('up');
    if(e.key === "ArrowDown" || e.key === "s" || e.key === "S") moveBall('down');
    if(e.key === "ArrowLeft" || e.key === "a" || e.key === "A") moveBall('left');
    if(e.key === "ArrowRight" || e.key === "d" || e.key === "D") moveBall('right');
  });
</script>
</body>
</html>
