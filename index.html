<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D Car Racing</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/GLTFLoader.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            overflow: hidden;
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #1a2a6c);
            color: white;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .game-container {
            position: relative;
            width: 100%;
            height: 100%;
            max-width: 1200px;
            max-height: 800px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            border-radius: 10px;
            overflow: hidden;
        }
        
        #gameCanvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
        }
        
        .ui-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 2;
            pointer-events: none;
        }
        
        .game-header {
            display: flex;
            justify-content: space-between;
            padding: 20px;
        }
        
        .stats {
            background: rgba(0, 0, 0, 0.6);
            padding: 15px 25px;
            border-radius: 10px;
            display: flex;
            gap: 30px;
        }
        
        .stat-box {
            text-align: center;
        }
        
        .stat-value {
            font-size: 28px;
            font-weight: bold;
            color: #ffcc00;
            margin-top: 5px;
        }
        
        .stat-label {
            font-size: 14px;
            opacity: 0.8;
        }
        
        .game-title {
            text-align: center;
            font-size: 32px;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 3px;
            text-shadow: 0 0 10px rgba(255, 204, 0, 0.8);
            margin-top: 20px;
        }
        
        .controls {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.6);
            padding: 15px 30px;
            border-radius: 10px;
            display: flex;
            gap: 20px;
        }
        
        .control-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .key {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.4);
            padding: 5px 15px;
            border-radius: 5px;
            font-weight: bold;
        }
        
        .start-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            z-index: 10;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            pointer-events: all;
        }
        
        .start-screen h1 {
            font-size: 60px;
            margin-bottom: 20px;
            color: #ffcc00;
            text-shadow: 0 0 15px rgba(255, 204, 0, 0.7);
            letter-spacing: 3px;
        }
        
        .start-screen p {
            font-size: 20px;
            max-width: 600px;
            margin-bottom: 40px;
            line-height: 1.6;
            opacity: 0.9;
        }
        
        .btn {
            background: linear-gradient(to right, #ffcc00, #ff6600);
            color: #000;
            border: none;
            padding: 15px 50px;
            font-size: 18px;
            font-weight: bold;
            border-radius: 50px;
            cursor: pointer;
            text-transform: uppercase;
            letter-spacing: 2px;
            box-shadow: 0 5px 15px rgba(255, 102, 0, 0.4);
            transition: all 0.3s ease;
        }
        
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(255, 102, 0, 0.6);
        }
        
        .btn:active {
            transform: translateY(1px);
        }
        
        .lap-counter {
            position: absolute;
            top: 30px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.6);
            padding: 10px 30px;
            border-radius: 50px;
            font-size: 18px;
            font-weight: bold;
        }
        
        .lap-number {
            color: #ffcc00;
            font-size: 24px;
        }
        
        .position-indicator {
            position: absolute;
            top: 80px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.6);
            padding: 8px 25px;
            border-radius: 50px;
            font-size: 16px;
        }
        
        .speedometer {
            position: absolute;
            bottom: 150px;
            right: 30px;
            width: 150px;
            height: 150px;
            background: rgba(0, 0, 0, 0.6);
            border-radius: 50%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            border: 3px solid rgba(255, 255, 255, 0.2);
        }
        
        .speed-value {
            font-size: 30px;
            font-weight: bold;
            color: #ffcc00;
        }
        
        .speed-label {
            font-size: 14px;
            opacity: 0.8;
            margin-top: 5px;
        }
        
        .nitro-indicator {
            position: absolute;
            bottom: 30px;
            right: 30px;
            width: 30px;
            height: 150px;
            background: rgba(0, 0, 0, 0.4);
            border-radius: 15px;
            overflow: hidden;
            border: 2px solid rgba(255, 255, 255, 0.2);
        }
        
        .nitro-fill {
            position: absolute;
            bottom: 0;
            width: 100%;
            height: 70%;
            background: linear-gradient(to top, #00ccff, #0066ff);
            border-radius: 15px;
        }
        
        .nitro-label {
            position: absolute;
            top: -25px;
            width: 100%;
            text-align: center;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div id="gameCanvas"></div>
        
        <div class="ui-overlay">
            <div class="game-header">
                <div class="stats">
                    <div class="stat-box">
                        <div class="stat-label">Lap Time</div>
                        <div class="stat-value" id="lapTime">1:45.20</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-label">Best Lap</div>
                        <div class="stat-value" id="bestLap">1:42.83</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-label">Position</div>
                        <div class="stat-value" id="position">3/8</div>
                    </div>
                </div>
            </div>
            
            <div class="game-title">Turbo Racer</div>
            
            <div class="lap-counter">
                Lap: <span class="lap-number" id="currentLap">2</span>/3
            </div>
            
            <div class="position-indicator">
                Position: <span class="position-number">3rd</span>
            </div>
            
            <div class="speedometer">
                <div class="speed-value" id="speed">246</div>
                <div class="speed-label">km/h</div>
            </div>
            
            <div class="nitro-indicator">
                <div class="nitro-label">NITRO</div>
                <div class="nitro-fill"></div>
            </div>
            
            <div class="controls">
                <div class="control-item">
                    <div class="key">W</div>
                    <div class="label">Accelerate</div>
                </div>
                <div class="control-item">
                    <div class="key">A</div>
                    <div class="label">Left</div>
                </div>
                <div class="control-item">
                    <div class="key">D</div>
                    <div class="label">Right</div>
                </div>
                <div class="control-item">
                    <div class="key">SPACE</div>
                    <div class="label">Nitro</div>
                </div>
            </div>
        </div>
        
        <div class="start-screen" id="startScreen">
            <h1>Turbo Racer</h1>
            <p>Race through challenging tracks at high speed. Avoid obstacles, use nitro boosts strategically, and climb to first place!</p>
            <button class="btn" id="startBtn">Start Race</button>
            <div class="controls" style="position: relative; bottom: auto; margin-top: 40px;">
                <div class="control-item">
                    <div class="key">W</div>
                    <div class="label">Accelerate</div>
                </div>
                <div class="control-item">
                    <div class="key">A/D</div>
                    <div class="label">Steer</div>
                </div>
                <div class="control-item">
                    <div class="key">SPACE</div>
                    <div class="label">Nitro Boost</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Initialize Three.js scene
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0x87CEEB);
        
        // Create camera
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.set(0, 5, 10);
        
        // Create renderer
        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(window.devicePixelRatio);
        document.getElementById('gameCanvas').appendChild(renderer.domElement);
        
        // Add lighting
        const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
        scene.add(ambientLight);
        
        const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
        directionalLight.position.set(100, 100, 50);
        scene.add(directionalLight);
        
        // Create a simple track
        function createTrack() {
            const trackGeometry = new THREE.BoxGeometry(20, 0.1, 100);
            const trackMaterial = new THREE.MeshStandardMaterial({ 
                color: 0x444444,
                roughness: 0.9,
                metalness: 0.1
            });
            const track = new THREE.Mesh(trackGeometry, trackMaterial);
            track.position.y = -0.5;
            scene.add(track);
            
            // Add track markings
            for (let i = -50; i < 50; i += 4) {
                const markingGeometry = new THREE.BoxGeometry(0.5, 0.11, 2);
                const markingMaterial = new THREE.MeshStandardMaterial({ color: 0xffffff });
                const marking = new THREE.Mesh(markingGeometry, markingMaterial);
                marking.position.z = i;
                scene.add(marking);
            }
            
            // Add borders
            const borderGeometry = new THREE.BoxGeometry(22, 0.5, 100);
            const borderMaterial = new THREE.MeshStandardMaterial({ color: 0x333333 });
            const leftBorder = new THREE.Mesh(borderGeometry, borderMaterial);
            leftBorder.position.set(-11, 0, 0);
            scene.add(leftBorder);
            
            const rightBorder = new THREE.Mesh(borderGeometry, borderMaterial);
            rightBorder.position.set(11, 0, 0);
            scene.add(rightBorder);
        }
        
        // Create player car
        function createPlayerCar() {
            const carGroup = new THREE.Group();
            
            // Car body
            const bodyGeometry = new THREE.BoxGeometry(2, 0.8, 4);
            const bodyMaterial = new THREE.MeshStandardMaterial({ color: 0xff3300 });
            const body = new THREE.Mesh(bodyGeometry, bodyMaterial);
            body.position.y = 0.4;
            carGroup.add(body);
            
            // Car top
            const topGeometry = new THREE.BoxGeometry(1.5, 0.7, 2);
            const topMaterial = new THREE.MeshStandardMaterial({ color: 0xff3300 });
            const top = new THREE.Mesh(topGeometry, topMaterial);
            top.position.set(0, 0.9, -0.3);
            carGroup.add(top);
            
            // Wheels
            const wheelGeometry = new THREE.CylinderGeometry(0.4, 0.4, 0.3, 16);
            wheelGeometry.rotateZ(Math.PI / 2);
            const wheelMaterial = new THREE.MeshStandardMaterial({ color: 0x222222 });
            
            const wheelPositions = [
                [-0.8, 0.4, 1.5],
                [0.8, 0.4, 1.5],
                [-0.8, 0.4, -1.5],
                [0.8, 0.4, -1.5]
            ];
            
            wheelPositions.forEach(pos => {
                const wheel = new THREE.Mesh(wheelGeometry, wheelMaterial);
                wheel.position.set(pos[0], pos[1], pos[2]);
                carGroup.add(wheel);
            });
            
            carGroup.position.y = 0.5;
            scene.add(carGroup);
            return carGroup;
        }
        
        // Create opponent cars
        function createOpponentCars(count) {
            const cars = [];
            const colors = [0x0099ff, 0x00cc00, 0xffff00, 0xcc00ff];
            
            for (let i = 0; i < count; i++) {
                const carGroup = new THREE.Group();
                
                // Car body
                const bodyGeometry = new THREE.BoxGeometry(2, 0.8, 4);
                const bodyMaterial = new THREE.MeshStandardMaterial({ color: colors[i % colors.length] });
                const body = new THREE.Mesh(bodyGeometry, bodyMaterial);
                body.position.y = 0.4;
                carGroup.add(body);
                
                // Wheels
                const wheelGeometry = new THREE.CylinderGeometry(0.4, 0.4, 0.3, 16);
                wheelGeometry.rotateZ(Math.PI / 2);
                const wheelMaterial = new THREE.MeshStandardMaterial({ color: 0x222222 });
                
                const wheelPositions = [
                    [-0.8, 0.4, 1.5],
                    [0.8, 0.4, 1.5],
                    [-0.8, 0.4, -1.5],
                    [0.8, 0.4, -1.5]
                ];
                
                wheelPositions.forEach(pos => {
                    const wheel = new THREE.Mesh(wheelGeometry, wheelMaterial);
                    wheel.position.set(pos[0], pos[1], pos[2]);
                    carGroup.add(wheel);
                });
                
                carGroup.position.y = 0.5;
                carGroup.position.z = -20 - i * 10;
                carGroup.position.x = (Math.random() - 0.5) * 10;
                scene.add(carGroup);
                cars.push(carGroup);
            }
            
            return cars;
        }
        
        // Create environment
        function createEnvironment() {
            // Add some mountains in the distance
            const mountainGroup = new THREE.Group();
            for (let i = 0; i < 20; i++) {
                const size = 30 + Math.random() * 30;
                const mountainGeometry = new THREE.ConeGeometry(size, 50 + Math.random() * 50, 4);
                const mountainMaterial = new THREE.MeshStandardMaterial({ 
                    color: 0x4d2600,
                    roughness: 0.9
                });
                const mountain = new THREE.Mesh(mountainGeometry, mountainMaterial);
                mountain.position.x = (Math.random() - 0.5) * 500;
                mountain.position.z = -100 - Math.random() * 300;
                mountain.position.y = -25;
                mountainGroup.add(mountain);
            }
            scene.add(mountainGroup);
            
            // Add sky
            const skyGeometry = new THREE.SphereGeometry(500, 32, 32);
            const skyMaterial = new THREE.MeshBasicMaterial({ 
                color: 0x87CEEB,
                side: THREE.BackSide
            });
            const sky = new THREE.Mesh(skyGeometry, skyMaterial);
            scene.add(sky);
        }
        
        // Initialize game objects
        createTrack();
        const playerCar = createPlayerCar();
        const opponentCars = createOpponentCars(5);
        createEnvironment();
        
        // Game state
        const gameState = {
            started: false,
            speed: 0,
            maxSpeed: 300,
            acceleration: 0,
            playerPosition: { x: 0, z: 0 },
            rotation: 0,
            lap: 1,
            position: 3,
            lapTime: 0,
            bestLap: 0,
            nitro: 100,
            usingNitro: false
        };
        
        // Handle keyboard input
        const keys = {};
        window.addEventListener('keydown', (e) => {
            keys[e.key.toLowerCase()] = true;
            
            if (e.key === ' ' && gameState.nitro > 20 && gameState.started) {
                gameState.usingNitro = true;
            }
        });
        
        window.addEventListener('keyup', (e) => {
            keys[e.key.toLowerCase()] = false;
            
            if (e.key === ' ') {
                gameState.usingNitro = false;
            }
        });
        
        // Start button
        document.getElementById('startBtn').addEventListener('click', () => {
            document.getElementById('startScreen').style.display = 'none';
            gameState.started = true;
            gameState.lapTime = 0;
            gameLoop();
        });
        
        // Game loop
        function gameLoop() {
            if (!gameState.started) return;
            
            // Update game state
            updateGame();
            
            // Render scene
            renderer.render(scene, camera);
            
            // Continue loop
            requestAnimationFrame(gameLoop);
        }
        
        function updateGame() {
            // Update camera to follow player
            camera.position.set(playerCar.position.x, 5, playerCar.position.z + 8);
            camera.lookAt(playerCar.position.x, 0, playerCar.position.z - 10);
            
            // Handle acceleration
            if (keys['w'] || keys['arrowup']) {
                gameState.acceleration = 0.1;
            } else {
                gameState.acceleration = -0.05;
            }
            
            // Handle steering
            if (keys['a'] || keys['arrowleft']) {
                gameState.rotation = -0.03;
            } else if (keys['d'] || keys['arrowright']) {
                gameState.rotation = 0.03;
            } else {
                gameState.rotation *= 0.9;
            }
            
            // Apply nitro
            if (gameState.usingNitro && gameState.nitro > 0) {
                gameState.acceleration *= 2;
                gameState.nitro -= 0.5;
                document.querySelector('.nitro-fill').style.height = `${gameState.nitro}%`;
            } else if (gameState.nitro < 100) {
                gameState.nitro += 0.05;
                document.querySelector('.nitro-fill').style.height = `${gameState.nitro}%`;
            }
            
            // Update speed
            gameState.speed += gameState.acceleration;
            gameState.speed = Math.max(0, Math.min(gameState.maxSpeed, gameState.speed));
            
            // Update position
            playerCar.rotation.y = gameState.rotation;
            playerCar.position.x += Math.sin(playerCar.rotation.y) * (gameState.speed / 100);
            playerCar.position.z -= Math.cos(playerCar.rotation.y) * (gameState.speed / 100);
            
            // Keep player on track
            playerCar.position.x = Math.max(-8, Math.min(8, playerCar.position.x));
            
            // Update opponent cars
            opponentCars.forEach((car, index) => {
                car.position.z += gameState.speed / 100;
                
                // Simple AI movement
                if (Math.random() < 0.01) {
                    car.position.x = (Math.random() - 0.5) * 12;
                }
                
                // Reset position if behind
                if (car.position.z > 50) {
                    car.position.z = -50 - Math.random() * 50;
                }
            });
            
            // Update UI
            document.getElementById('speed').textContent = Math.floor(gameState.speed);
            document.getElementById('lapTime').textContent = formatTime(gameState.lapTime);
            document.getElementById('position').textContent = `${gameState.position}/8`;
            
            // Update lap time
            gameState.lapTime += 0.01;
        }
        
        // Format time as minutes:seconds.milliseconds
        function formatTime(time) {
            const minutes = Math.floor(time / 60);
            const seconds = Math.floor(time % 60);
            const milliseconds = Math.floor((time % 1) * 100);
            return `${minutes}:${seconds.toString().padStart(2, '0')}.${milliseconds.toString().padStart(2, '0')}`;
        }
        
        // Initial render
        renderer.render(scene, camera);
        
        // Handle window resize
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });
    </script>
</body>
</html>
